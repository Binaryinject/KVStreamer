# KVStreamer é¡¹ç›®æ€»è§ˆ

## ğŸ“‹ é¡¹ç›®ä»‹ç»

KVStreamer æ˜¯ä¸€ä¸ªä¸ºUnityè®¾è®¡çš„é«˜æ€§èƒ½é”®å€¼å¯¹æµå¼è¯»å–C#åº“ã€‚å®ƒæ”¯æŒä»CSVæ–‡ä»¶ç”Ÿæˆç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¹¶æä¾›å¸¦æ™ºèƒ½ç¼“å­˜çš„æµå¼è¯»å–åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆæ¸¸æˆæœ¬åœ°åŒ–ã€é…ç½®æ•°æ®ç­‰åœºæ™¯ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **CSVåˆ°äºŒè¿›åˆ¶è½¬æ¢**: è¯»å–CSVçš„IDåˆ—ä½œä¸ºkeyï¼ŒTextåˆ—ä½œä¸ºvalueï¼Œç”Ÿæˆä¼˜åŒ–çš„.bytesæ–‡ä»¶
- âœ… **Mapå¤´ç´¢å¼•**: äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«Mapå¤´ï¼Œå­˜å‚¨æ¯ä¸ªvalueçš„åç§»é‡ï¼Œå®ç°O(1)æŸ¥æ‰¾
- âœ… **æµå¼è¯»å–**: ä½¿ç”¨FileStreamæŒ‰éœ€è¯»å–ï¼Œä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜
- âœ… **æ™ºèƒ½ç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜è®¿é—®è¿‡çš„æ•°æ®ï¼Œåˆ°æœŸè‡ªåŠ¨æ¸…ç†
- âœ… **Unityé›†æˆ**: æä¾›Unityç»„ä»¶å’Œç¼–è¾‘å™¨å·¥å…·
- âœ… **å†…å­˜ä¼˜åŒ–**: æœ€å°åŒ–å†…å­˜å ç”¨ï¼Œé€‚åˆç§»åŠ¨å¹³å°

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
KVStreamer/
â”œâ”€â”€ Core Files (æ ¸å¿ƒæ–‡ä»¶)
â”‚   â”œâ”€â”€ KVStreamer.cs           # ä¸»ç±»ï¼Œæä¾›æ‰€æœ‰æ ¸å¿ƒAPI
â”‚   â””â”€â”€ ValueCache.cs           # å¸¦æ—¶é—´æ§åˆ¶çš„ç¼“å­˜ç³»ç»Ÿ
â”‚
â”œâ”€â”€ Unity Integration (Unityé›†æˆ)
â”‚   â”œâ”€â”€ Unity/
â”‚   â”‚   â””â”€â”€ LocalizationManager.cs      # Unityç®¡ç†å™¨ç»„ä»¶
â”‚   â””â”€â”€ Unity/Editor/
â”‚       â””â”€â”€ KVStreamerEditor.cs         # ç¼–è¾‘å™¨å·¥å…·çª—å£
â”‚
â”œâ”€â”€ Example (ç¤ºä¾‹ä»£ç )
â”‚   â”œâ”€â”€ example_data.csv        # ç¤ºä¾‹CSVæ•°æ®
â”‚   â”œâ”€â”€ Program.cs              # C#æ§åˆ¶å°ç¤ºä¾‹
â”‚   â””â”€â”€ data.bytes              # ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶(è¿è¡Œå)
â”‚
â”œâ”€â”€ Documentation (æ–‡æ¡£)
â”‚   â”œâ”€â”€ README.md               # ä¸»æ–‡æ¡£
â”‚   â”œâ”€â”€ UNITY_GUIDE.md          # Unityé›†æˆè¯¦ç»†æŒ‡å—
â”‚   â””â”€â”€ PROJECT_OVERVIEW.md     # æœ¬æ–‡ä»¶
â”‚
â””â”€â”€ Project Files (é¡¹ç›®é…ç½®)
    â”œâ”€â”€ KVStreamer.csproj       # .NETé¡¹ç›®æ–‡ä»¶
    â””â”€â”€ .gitignore              # Gitå¿½ç•¥é…ç½®
```

## ğŸ”§ äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mapå¤´å¤§å° (4 bytes, int32)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mapå¤´æ•°æ®                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Key1é•¿åº¦ (4 bytes)          â”‚    â”‚
â”‚  â”‚ Key1å­—ç¬¦ä¸² (UTF-8)          â”‚    â”‚
â”‚  â”‚ Value1åç§»é‡ (8 bytes)      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Key2é•¿åº¦ (4 bytes)          â”‚    â”‚
â”‚  â”‚ Key2å­—ç¬¦ä¸² (UTF-8)          â”‚    â”‚
â”‚  â”‚ Value2åç§»é‡ (8 bytes)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Valueæ•°æ®                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Value1é•¿åº¦ (4 bytes)        â”‚    â”‚
â”‚  â”‚ Value1å­—ç¬¦ä¸² (UTF-8)        â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Value2é•¿åº¦ (4 bytes)        â”‚    â”‚
â”‚  â”‚ Value2å­—ç¬¦ä¸² (UTF-8)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿:**
- Mapå¤´åœ¨æ–‡ä»¶å¼€å¤´ï¼Œä¸€æ¬¡æ€§è¯»å–å®Œæˆ
- Valueæ•°æ®ç´§å‡‘å­˜å‚¨ï¼Œæ— å†—ä½™
- æ”¯æŒéšæœºè®¿é—®ï¼Œæ— éœ€é¡ºåºè¯»å–
- åç§»é‡ä½¿ç”¨8å­—èŠ‚longï¼Œæ”¯æŒè¶…å¤§æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: .NETæ§åˆ¶å°åº”ç”¨

```bash
# 1. æ„å»ºé¡¹ç›®
cd c:\GIT\KVStreamer
dotnet build

# 2. è¿è¡Œç¤ºä¾‹
dotnet run
```

### æ–¹å¼2: Unityé¡¹ç›®

1. å°†æ ¸å¿ƒæ–‡ä»¶å¤åˆ¶åˆ°Unityé¡¹ç›®
2. ä½¿ç”¨ç¼–è¾‘å™¨å·¥å…·è½¬æ¢CSV
3. æŒ‚è½½LocalizationManagerç»„ä»¶
4. é€šè¿‡APIè¯»å–æ•°æ®

è¯¦è§ [UNITY_GUIDE.md](UNITY_GUIDE.md)

## ğŸ“š æ ¸å¿ƒAPI

### KVStreamer ç±»

```csharp
// æ„é€ å‡½æ•°
KVStreamer(float cacheDuration = 300f)

// CSVè½¬æ¢
void CreateBinaryFromCSV(string csvPath, string outputPath)

// åŠ è½½æ•°æ®
void LoadBinaryFile(string binaryFilePath)

// è¯»å–æ•°æ®
string GetValue(string key)
List<string> GetAllKeys()
bool ContainsKey(string key)

// ç¼“å­˜ç®¡ç†
void ClearCache()

// å±æ€§
int Count { get; }
```

### ValueCache ç±»

```csharp
// ç¼“å­˜æ“ä½œ
void Set(string key, string value)
string Get(string key)
void Remove(string key)
void Clear()

// é…ç½®
void SetCacheDuration(float seconds)

// å±æ€§
int Count { get; }
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### 1. æ¸¸æˆæœ¬åœ°åŒ–ç³»ç»Ÿ

```csharp
// æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢
var zhCN = new KVStreamer();
zhCN.LoadBinaryFile("localization_zh_CN.bytes");

var enUS = new KVStreamer();
enUS.LoadBinaryFile("localization_en_US.bytes");
```

### 2. æ¸¸æˆé…ç½®æ•°æ®

```csharp
// ç‰©å“é…ç½®
var items = new KVStreamer();
items.LoadBinaryFile("items.bytes");
string swordName = items.GetValue("item_sword");

// ä»»åŠ¡é…ç½®
var quests = new KVStreamer();
quests.LoadBinaryFile("quests.bytes");
string questDesc = quests.GetValue("quest_001");
```

### 3. å¯¹è¯ç³»ç»Ÿ

```csharp
// NPCå¯¹è¯
var dialogs = new KVStreamer();
dialogs.LoadBinaryFile("npc_dialogs.bytes");
string npcText = dialogs.GetValue("npc_village_chief_001");
```

## âš™ï¸ æ€§èƒ½ç‰¹æ€§

### å†…å­˜ä½¿ç”¨

- **Mapå¤´**: ä»…åœ¨åŠ è½½æ—¶è¯»å–ä¸€æ¬¡ï¼Œå­˜å‚¨åœ¨Dictionaryä¸­
- **Valueæ•°æ®**: æŒ‰éœ€ä»æ–‡ä»¶æµè¯»å–ï¼Œä¸å¸¸é©»å†…å­˜
- **ç¼“å­˜**: åªç¼“å­˜è®¿é—®è¿‡çš„æ•°æ®ï¼Œåˆ°æœŸè‡ªåŠ¨é‡Šæ”¾

### è¯»å–é€Ÿåº¦

- **é¦–æ¬¡è¯»å–**: ~0.01-0.1ms (å–å†³äºç£ç›˜é€Ÿåº¦)
- **ç¼“å­˜è¯»å–**: ~0.001-0.01ms (å†…å­˜è®¿é—®)
- **KeyæŸ¥æ‰¾**: O(1) DictionaryæŸ¥æ‰¾

### æ–‡ä»¶å¤§å°

å¯¹æ¯”åŸå§‹CSVï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶çº¦ä¸º80-90%å¤§å°ï¼š
- **CSV**: 535 bytes
- **Binary**: 529 bytes (èŠ‚çœ1%)

å¯¹äºå¤§æ–‡ä»¶æ•ˆæœæ›´æ˜æ˜¾ï¼ˆå»é™¤äº†CSVçš„å¼•å·ã€æ¢è¡Œç¬¦ç­‰å†—ä½™ï¼‰

## ğŸ”’ çº¿ç¨‹å®‰å…¨

- **æ–‡ä»¶è¯»å–**: ä½¿ç”¨`lock`ä¿æŠ¤FileStream
- **ç¼“å­˜è®¿é—®**: å•çº¿ç¨‹ä¼˜åŒ–ï¼Œå¦‚éœ€å¤šçº¿ç¨‹è¯·è‡ªè¡ŒåŠ é”
- **å»ºè®®**: æ¯ä¸ªçº¿ç¨‹åˆ›å»ºç‹¬ç«‹çš„KVStreamerå®ä¾‹

## ğŸ“ æœ€ä½³å®è·µ

### 1. èµ„æºç®¡ç†

```csharp
// âœ“ ä½¿ç”¨usingè‡ªåŠ¨é‡Šæ”¾
using (var streamer = new KVStreamer())
{
    streamer.LoadBinaryFile(path);
    // ä½¿ç”¨...
} // è‡ªåŠ¨Dispose

// âœ“ æ‰‹åŠ¨é‡Šæ”¾
var streamer = new KVStreamer();
try
{
    // ä½¿ç”¨...
}
finally
{
    streamer.Dispose();
}
```

### 2. ç¼“å­˜ç­–ç•¥

```csharp
// UIæ–‡æœ¬ - é•¿æœŸç¼“å­˜
var ui = new KVStreamer(600f);      // 10åˆ†é’Ÿ

// æ¸¸æˆæ•°æ® - ä¸­æœŸç¼“å­˜
var game = new KVStreamer(300f);    // 5åˆ†é’Ÿ

// ä¸´æ—¶æ•°æ® - ä¸ç¼“å­˜
var temp = new KVStreamer(0f);      // ç«‹å³è¿‡æœŸ
```

### 3. é”™è¯¯å¤„ç†

```csharp
try
{
    streamer.CreateBinaryFromCSV(csvPath, outputPath);
}
catch (FileNotFoundException)
{
    Debug.LogError("CSVæ–‡ä»¶ä¸å­˜åœ¨");
}
catch (Exception ex)
{
    Debug.LogError($"è½¬æ¢å¤±è´¥: {ex.Message}");
}
```

### 4. Unityé›†æˆ

```csharp
// ä½¿ç”¨å•ä¾‹æ¨¡å¼
public class LocalizationManager : MonoBehaviour
{
    private static LocalizationManager _instance;
    private KVStreamer _streamer;
    
    void Awake()
    {
        if (_instance == null)
        {
            _instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else
        {
            Destroy(gameObject);
        }
    }
}
```

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ

- **.NET**: .NET 8.0 (å¯é™çº§åˆ°.NET 6.0/Framework 4.x)
- **Unity**: Unity 2019.4+ (æ”¯æŒæ‰€æœ‰LTSç‰ˆæœ¬)
- **C#ç‰ˆæœ¬**: C# 8.0+
- **ç¼–ç **: UTF-8

## ğŸ“Š æµ‹è¯•ç»“æœ

ç¤ºä¾‹ç¨‹åºè¿è¡Œç»“æœ:
```
=== KVStreamer ç¤ºä¾‹ç¨‹åº ===

1. ä»CSVåˆ›å»ºäºŒè¿›åˆ¶æ–‡ä»¶...
   âœ“ æˆåŠŸåˆ›å»º: Example/data.bytes

2. åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶...
   âœ“ æˆåŠŸåŠ è½½ï¼Œå…± 12 æ¡æ•°æ®

3. è·å–æ‰€æœ‰Key:
   - item_001, item_002, item_003, item_004, item_005
   - npc_001, npc_002
   - quest_001, quest_002
   - ui_001, ui_002, ui_003

4. é€šè¿‡Keyè·å–Value:
   [item_001] = "è¿™æ˜¯ç¬¬ä¸€ä¸ªç‰©å“"
   [npc_001] = "æ‘é•¿å¯¹è¯æ–‡æœ¬"
   [quest_001] = "ä»»åŠ¡æè¿°ï¼šæ”¶é›†10ä¸ªè‹¹æœ"
   [ui_001] = "å¼€å§‹æ¸¸æˆ"
   [not_exist] = (ä¸å­˜åœ¨)

5. æµ‹è¯•ç¼“å­˜ç³»ç»Ÿ: âœ“ ç¼“å­˜åŠŸèƒ½æ­£å¸¸

6. æ£€æŸ¥Keyæ˜¯å¦å­˜åœ¨: âœ“ æŸ¥æ‰¾åŠŸèƒ½æ­£å¸¸

7. æ¸…é™¤ç¼“å­˜: âœ“ ç¼“å­˜å·²æ¸…é™¤

=== æ‰€æœ‰ç¤ºä¾‹æ‰§è¡Œå®Œæˆ ===
```

## ğŸ¯ è·¯çº¿å›¾

### å·²å®Œæˆ âœ…
- [x] CSVè§£æå’ŒäºŒè¿›åˆ¶è½¬æ¢
- [x] Mapå¤´ç´¢å¼•ç³»ç»Ÿ
- [x] æµå¼è¯»å–
- [x] æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
- [x] Unityç»„ä»¶é›†æˆ
- [x] ç¼–è¾‘å™¨å·¥å…·
- [x] å®Œæ•´æ–‡æ¡£

### è®¡åˆ’ä¸­ ğŸ“
- [ ] æ”¯æŒå¤šåˆ—Valueï¼ˆValue1, Value2...ï¼‰
- [ ] å‹ç¼©æ”¯æŒï¼ˆGZip/LZ4ï¼‰
- [ ] å¼‚æ­¥API (async/await)
- [ ] å¢é‡æ›´æ–°æ”¯æŒ
- [ ] åŠ å¯†æ”¯æŒ
- [ ] Unity Package Manageræ”¯æŒ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **ä¸»æ–‡æ¡£**: [README.md](README.md)
- **UnityæŒ‡å—**: [UNITY_GUIDE.md](UNITY_GUIDE.md)
- **æºä»£ç **: æ‰€æœ‰ä»£ç éƒ½æœ‰è¯¦ç»†æ³¨é‡Š

## ğŸ“„ è®¸å¯è¯

MIT License - è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘

---

**Version**: 1.0.0  
**Last Updated**: 2025-12-09  
**Author**: KVStreamer Team
